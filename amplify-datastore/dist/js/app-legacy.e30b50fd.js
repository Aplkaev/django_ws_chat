(function(){"use strict";var t={4635:function(t,e,n){n(6992),n(8674),n(9601),n(7727);var s=n(8935),o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"app"}},[n("PlaceMessanger")],1)},i=[],a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("div",{staticClass:"place__conteiner"},[void 0===t.hasRoomName||null===t.hasRoomName?n("div",{staticClass:"place__input_room"},[n("RoomPlace")],1):n("div",{staticClass:"w-100 d-flex flex-column align-items-center justify-content-between h-100"},[n("div",{staticClass:"w-100 nav p-2"},[n("b-button",{staticClass:"button_back_select_room",attrs:{variant:"outline-primary"},on:{click:t.BackSelectRoom}},[t._v("Назад ")])],1),n("div",{staticClass:"place__border"},[n("MessagesView"),n("InputMessanger")],1),n("div",{staticClass:"user_len w-100"},[n("b-alert",{attrs:{show:""}},[t._v("Количество людей в комнате: "+t._s(t.lenUsersRoom))])],1)])])])},r=[],c=n(4665),u=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"place__messages"},[n("notifications",{attrs:{group:"error_message"}}),t._l(t.getMessages,(function(e){return n("div",{key:e.message},[n("div",{staticClass:"place__message"},[n("div",{staticClass:"place__item_message",class:e.class},[t._v(" "+t._s(e.message)+" ")])])])})),t.typing.list?n("div",{staticClass:"place__message_typing m-2 position-absolute"},[t._v(" "+t._s(t.typing.list.join(","))+" "),1==t.typing.list.length?n("span",[t._v("печатает")]):t._e(),t.typing.list.length>1?n("span",[t._v("печатают")]):t._e()]):t._e()],2)},l=[],m=(n(8862),n(6699),n(2023),n(561),{name:"MessagesView",computed:(0,c.Se)(["getMessages","getMyId"]),data:function(){var t=this;return{items:[],typing:{timeout:{},list:[]},users_len:0,methods:{send:function(e){console.log(e),e["user"]==t.getMyId&&(console.log("my_message"),e.class="item_my"),t.$store.dispatch("SET_Messages",e)},error:function(e){console.log(e),e["user"]==t.getMyId&&t.$notify({group:"error_message",title:"Important message",type:"error",text:e.message})},users_len:function(e){t.users_len=e.len,t.$store.state.users_len=t.users_len},person_confirm:function(){t.chatSocket.send(JSON.stringify({event:"connect",user:t.getMyId}))},typing:function(e){t.typing.list.includes(e["user"])?clearTimeout(t.typing.timeout[e["user"]]):t.typing.list.push(e["user"]),t.typing.timeout[e["user"]]=setTimeout((function(e){var n=t.typing.list.indexOf(e);t.typing.list.splice(n,1),delete t.typing.timeout[e]}),2e3,e["user"])},typing_stop:function(e){if(t.typing.list.includes(e["user"])){var n=t.typing.list.indexOf(e["user"]);t.typing.list.splice(n,1),delete t.typing.timeout[e["user"]]}}}}},mounted:function(){var t=this;this.$store.dispatch("RM_Messages",[]),this.chatSocket=this.socket.getConnectSocet(),this.chatSocket.onmessage=function(e){var n=JSON.parse(e.data);t.methods[n["event"]]&&t.methods[n["event"]](n)}}}),d=m,f=n(3736),_=(0,f.Z)(d,u,l,!1,null,null,null),p=_.exports,g=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("form",{staticClass:"place__input",attrs:{action:""},on:{submit:function(e){return e.preventDefault(),t.onSubmit.apply(null,arguments)}}},[n("b-input-group",[n("b-form-input",{attrs:{placeholder:"Сообщение"},nativeOn:{keydown:function(e){return t.typing.apply(null,arguments)}},model:{value:t.message_text,callback:function(e){t.message_text=e},expression:"message_text"}}),n("b-input-group-append",[n("b-button",{attrs:{variant:"success",type:"submit"}},[t._v("Отправить")])],1)],1)],1)])},h=[],v={computed:(0,c.Se)(["getMyId"]),name:"InputMessanger",data:function(){return{message_text:"",chatSocket:null}},methods:{onSubmit:function(){void 0!==this.chatSocket&&null!==this.chatSocket||(this.chatSocket=this.socket.getConnectSocet()),this.chatSocket.send(JSON.stringify({event:"message",message:this.message_text,user:this.getMyId})),this.message_text=""},typing:function(){this.message_text?this.chatSocket.send(JSON.stringify({event:"typing",user:this.getMyId})):this.chatSocket.send(JSON.stringify({event:"typing_stop",user:this.getMyId}))}},mounted:function(){this.chatSocket=this.socket.getConnectSocet()}},y=v,b=(0,f.Z)(y,g,h,!1,null,null,null),S=b.exports,M=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"w-100"},[t._v(" Мой id: "+t._s(t.getMyId)+" "),n("form",{staticClass:"d-flex w-100",attrs:{action:""},on:{submit:function(e){return e.preventDefault(),t.onSubmit.apply(null,arguments)}}},[n("b-input-group",{staticClass:"mt-3"},[n("b-form-input",{attrs:{placeholder:"Название комнаты"},model:{value:t.nameRoom,callback:function(e){t.nameRoom=e},expression:"nameRoom"}}),n("b-input-group-append",[n("b-button",{attrs:{variant:"outline-primary",type:"submit"}},[t._v("Сохранить")])],1)],1)],1),n("div",{staticClass:"room__rows"},t._l(t.rooms,(function(e){return n("div",{key:e.name,staticClass:"room__row w-100 d-flex justify-content-between align-items-center my-2",on:{click:function(n){return t.selectRoom(e)}}},[n("div",{staticClass:" px-2"},[t._v(t._s(e.name)+" : "+t._s(e.users_len))]),n("b-button",{directives:[{name:"id",rawName:"v-id",value:e.login,expression:"room.login"}],attrs:{variant:"success"}},[t._v("Войти")])],1)})),0)])},k=[],w=(n(8309),n(6166)),x=n.n(w),R={computed:(0,c.Se)(["getMyId"]),name:"RoomPlace",data:function(){return{nameRoom:"",rooms:""}},methods:{onSubmit:function(){this.setRoom(this.nameRoom)},selectRoom:function(t){this.setRoom(t.name)},setRoom:function(t){t&&(this.$store.dispatch("SET_Name_room",t),this.socket.setNameRoom(t))}},mounted:function(){var t=this;x().get("http://127.0.0.1:8000/api/getRooms/").then((function(e){console.log("getRooms",e),t.rooms=e.data.items})),this.getMyId&&void 0!==this.getMyId&&"undefined"!==this.getMyId?this.socket.setMyId(this.getMyId):x().get("http://127.0.0.1:8000/api/getMyId/").then((function(e){t.$store.dispatch("SET_MY_ID",e.data.id),t.socket.setMyId(e.data.id)}))}},I=R,O=(0,f.Z)(I,M,k,!1,null,null,null),C=O.exports,N={name:"PlaceMessanger",components:{MessagesView:p,InputMessanger:S,RoomPlace:C},computed:(0,c.Se)(["lenUsersRoom","hasRoomName"]),data:function(){return{users_len:0,methods:{}}},methods:{BackSelectRoom:function(){this.$store.dispatch("SET_Name_room",null),this.socket.disconnect()}}},E=N,T=(0,f.Z)(E,a,r,!1,null,null,null),j=T.exports,P={name:"App",components:{PlaceMessanger:j},mounted:function(){}},$=P,Z=(0,f.Z)($,o,i,!1,null,null,null),J=Z.exports,A=n(8729),D=n.n(A),U=n(6762),V={roomName:"test",_connect:null,_urls_sokets:{chat:"ws://127.0.0.1:8000/ws/chat/",rooms:"ws://127.0.0.1:8000/ws/rooms/"},_main_ws:"chat",_my_id:-1,setMyId:function(t){this._my_id=t},setNameRoom:function(t){this.roomName=t},getConnectSocet:function(){return void 0!==this._connect&&this._connect||this.connect(),this._connect},connect:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"chat";this._connect=new WebSocket(this.getLink(e)),this._connect.onopen=function(){t._connect.send(JSON.stringify({event:"connect",user:t._my_id}))},this._connect.onclose=function(){t.roomName=null}},getLink:function(t){return void 0===this._urls_sokets[t]||"chat"===t?this._urls_sokets[this._main_ws]+this.roomName+"/":this._urls_sokets[t]},disconnect:function(){void 0!==this._connect&&this._connect&&(this._connect.close(),this._connect=null)}};s["default"].use(c.ZP);var B=new c.ZP.Store({actions:{SET_Name_room:function(t,e){t.commit("Set_name_room",e)},SET_Messages:function(t,e){t.commit("Add_messages",e)},RM_Messages:function(t){t.commit("Rm_messages")},SET_MY_ID:function(t,e){t.commit("Set_my_id",e)}},mutations:{Set_name_room:function(t,e){t.roomName=e},Add_messages:function(t,e){t.messages.push(e)},Rm_messages:function(t){t.messages.splice(0,t.messages.length)},Set_my_id:function(t,e){t.id=e,localStorage.setItem("my_id_client_message",e)}},state:{users_len:0,messages:[],roomName:null,id:0},getters:{lenUsersRoom:function(t){return t.users_len},getMessages:function(t){return t.messages},hasRoomName:function(t){return t.roomName},getMyId:function(t){if(!t.id||void 0===t.id){var e=localStorage.getItem("my_id_client_message");t.id=void 0!==e&&e?e:0}return t.id}},modules:{}}),L=n(8262),Y=n(3266);n(44);s["default"].use(L.XG7),s["default"].use(Y.A7),s["default"].use(U.Z,x()),s["default"].config.productionTip=!1,s["default"].prototype.socket=V,s["default"].use(D()),new s["default"]({socket:V,store:B,render:function(t){return t(J)}}).$mount("#app")}},e={};function n(s){var o=e[s];if(void 0!==o)return o.exports;var i=e[s]={id:s,loaded:!1,exports:{}};return t[s].call(i.exports,i,i.exports,n),i.loaded=!0,i.exports}n.m=t,function(){n.amdO={}}(),function(){var t=[];n.O=function(e,s,o,i){if(!s){var a=1/0;for(l=0;l<t.length;l++){s=t[l][0],o=t[l][1],i=t[l][2];for(var r=!0,c=0;c<s.length;c++)(!1&i||a>=i)&&Object.keys(n.O).every((function(t){return n.O[t](s[c])}))?s.splice(c--,1):(r=!1,i<a&&(a=i));if(r){t.splice(l--,1);var u=o();void 0!==u&&(e=u)}}return e}i=i||0;for(var l=t.length;l>0&&t[l-1][2]>i;l--)t[l]=t[l-1];t[l]=[s,o,i]}}(),function(){n.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return n.d(e,{a:e}),e}}(),function(){n.d=function(t,e){for(var s in e)n.o(e,s)&&!n.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})}}(),function(){n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){n.hmd=function(t){return t=Object.create(t),t.children||(t.children=[]),Object.defineProperty(t,"exports",{enumerable:!0,set:function(){throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+t.id)}}),t}}(),function(){n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){n.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}}(),function(){n.nmd=function(t){return t.paths=[],t.children||(t.children=[]),t}}(),function(){var t={143:0};n.O.j=function(e){return 0===t[e]};var e=function(e,s){var o,i,a=s[0],r=s[1],c=s[2],u=0;if(a.some((function(e){return 0!==t[e]}))){for(o in r)n.o(r,o)&&(n.m[o]=r[o]);if(c)var l=c(n)}for(e&&e(s);u<a.length;u++)i=a[u],n.o(t,i)&&t[i]&&t[i][0](),t[i]=0;return n.O(l)},s=self["webpackChunkamplify_datastore"]=self["webpackChunkamplify_datastore"]||[];s.forEach(e.bind(null,0)),s.push=e.bind(null,s.push.bind(s))}();var s=n.O(void 0,[998],(function(){return n(4635)}));s=n.O(s)})();
//# sourceMappingURL=app-legacy.e30b50fd.js.map